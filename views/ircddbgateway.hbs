<img src="/apple-icon-120x120.png" class="logo"/>
<h1>{{title}}</h1>
<h4>Raspberry Pi {{piModel.model}}, Memory {{piModel.memory}} {{piModel.notes}}<br/>
{{#if hat.name}}
{{hat.product}} by {{hat.vendor}}
{{else}}
Controller Not Detected
{{/if}}
</h4>
<form method="post">
   <fieldset>
   <legend>Gateway</legend>
   <p>Set your gateway callsign (which should match your repeater callsign without the module ID). Otherwise, generally use defaults for the other fields.</p>
   <p>When the callsign is entered, a URL will be automatically generated, that can be replaced.  The automatically generated URL will become active once your gateway reports into QuadNet and/or ircDDB.net</p>
   <table>
	<tr>
		<th>Gateway Type</th>
		<td class="ircinput">
			<select id="gatewayType" name="gatewayType" value="{{conf.gatewayType}}">
				<option value="0">Repeater</option>
				<option value="1">Hotspot</option>
				<option value="2">Dongle</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Gateway Callsign</th>
		<td class="ircinput">
			<input type="text" onkeyup="upcase(this)" maxlen=8 id="gatewayCallsign" name="gatewayCallsign" 
				value="{{conf.gatewayCallsign}}" required
				onchange="updateURL(this.value)"
				pattern="[A-Z0-9]{1}[A-Z0-9]{0,1}\d{1}[A-Z]{0,4}" 
            			title="A gateway callsign is up to 6 characters"/>&nbsp;G
		</td>
	</tr>
	<tr>
		<th>Gateway Listens On Local IP Address</th>
		<td class="ircinput">
			<input type="text" pattern="[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}" 
				title="Usually 127.0.0.1 or 0.0.0.0" name="hbAddress" id="hbAddress" 
				required value="{{conf.hbAddress}}"/>
		</td>
	</tr>
	<tr>
		<th>Gateway Listens On Local UDP Port</th>
		<td class="ircinput">
			<input type="text" pattern="\d{1,5}" 
				title="Usually 20010" name="hbPort" id="hbPort" 
				required value="{{conf.hbPort}}"/>
		</td>
	</tr>
	<tr>
		<th>Gateway Language</th>
		<td class="ircinput">
		        <select id="language" name="language" value="{{conf.language}}">
                                <option value="0">English (UK)</option>
                                <option value="1">Deutch</option>
                                <option value="2">Dansk</option>
                                <option value="3">Francais</option>
                                <option value="4">Italiano</option>
                                <option value="5">Polski</option>
                                <option value="6">English (US)</option>
                                <option value="7">Espanol</option>
                                <option value="8">Svenska</option>
                                <option value="9">Nederlands (NL)</option>
                                <option value="10">Nederlands (BE)</option>
                                <option value="11">Norsk</option>
                                <option value="12">Portugues</option>
                        </select>
		</td>
	</tr>
   </table>
   </fieldset>
   <fieldset>
   <legend>Gateway Location and URL</legend>
   <p>Latitude and Longitude are designated in decimal degrees use negative numbers for S and W</p>
   <table>
	<tr>
	<th>Latitude</th>
	<td>
		<input type="number" name="latitude" id="latitude" value="{{conf.latitude}}" required />&deg;
	</td>
	</tr>
	<tr>
	<th>Longitude</th>
	<td>
		<input type="number" name="longitude" id="longitude" value="{{conf.longitude}}" required />&deg;
	</td>
	</tr>
	<tr>
	<th>Description (QTH)</th>
	<td>
		<input type="text" maxlen=20 name="description1" id="description1" value="{{conf.description1}}" /><br/>
		<input type="text" maxlen=20 name="description2" id="description2" value="{{conf.description2}}" />
	</td>
	</tr>
	<tr>
	<th>URL</th>
	<td>
		<input type="url" name="url" id="url" value="{{conf.url}}" />
	</td>
	</tr>
   </table>
   </fieldset>

   <fieldset>
   <legend>UDRC Repeater</legend>
   <p>Setup your UDRC based repeater/hotspot as repeater 1 on this gateway</p>
   <table style="float:right">
	<thead>
		<tr>
			<th>Band Selection Convention</th>
		</tr>
		<tr>
			<th>Module/Band Letter</th>
			<th>Conventional Band Assignment</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>A</td><td>23cm or 1.25m</td>
		</tr>
		<tr>
			<td>B</td><td>70cm</td>
		</tr>
		<tr>
			<td>C</td><td>2m</td>
		</tr>
	</tbody>
   </table>
   <table>
	<tr>
		<th>Module/Band</th>
		<td class="ircinput">
			<select id="repeaterBand1" name="repeaterBand1" value="{{conf.repeaterBand1}}">
				<option value="">None</option>
				<option value="A">A</option>
				<option value="B">B</option>
				<option value="C">C</option>
				<option value="D">D</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Repeater Listens On IP Address</th>
		<td class="ircinput">
			<input type="text" pattern="[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}" 
				title="Usually 127.0.0.1 unless on LAN or remote" name="repeaterAddress1" id="repeaterAddress1" 
				required value="{{conf.repeaterAddress1}}"/>
		</td>
	</tr>
	<tr>
		<th>Repeater Listens On UDP Port</th>
		<td class="ircinput">
			<input type="text" pattern="\d{1,5}" 
				title="Usually 20011" name="repeaterPort1" id="repeaterPort1" 
				required value="{{conf.repeaterPort1}}"/>
		</td>
	</tr>
	<tr>
		<th>Link to {{conf.reflector1}}</th>
		<td>
			<input type="hidden" name="reflector1" id="reflector1" value="{{conf.reflector1}}" />
			<input type="text" onkeyup="upcase(this)" id="refin" onchange="setReflector('#reflector1')" />
			<select id="refmod" onchange="setReflector('#reflector1')">
				<option value='A'>A</option>
				<option value='B'>B</option>
				<option value='C'>C</option>
				<option value='D'>D</option>
				<option value='E'>E</option>
				<option value='F'>F</option>
				<option value='G'>G</option>
				<option value='H'>H</option>
				<option value='I'>I</option>
				<option value='J'>J</option>
				<option value='K'>K</option>
				<option value='L'>L</option>
				<option value='M'>M</option>
				<option value='N'>N</option>
				<option value='O'>O</option>
				<option value='P'>P</option>
				<option value='Q'>Q</option>
				<option value='R'>R</option>
				<option value='S'>S</option>
				<option value='T'>T</option>
				<option value='U'>U</option>
				<option value='V'>V</option>
				<option value='W'>W</option>
				<option value='X'>X</option>
				<option value='Y'>Y</option>
				<option value='Z'>Z</option>
			</select>
		</td>
	</tr>
	<tr>
		<th>Link on Gateway Start</th>
		<td>
			<input type="radio" name="atStartup1" id="atStartup1" value="1">Yes &nbsp;
			<input type="radio" name="atStartup1" id="atStartup1" value="0">No
		</td>
	</tr>
`	<tr>
		<th>Link absent local traffic</th>
		<td>
			<select id="reconnect1" name="reconnect1" value="{{conf.reconnect1}}">
				<option value="0">Never - Manually Link after disconnect</option>
				<option value="1">Fixed - Do not accept new link commands</option>
				<option value="2">After  5 minutes</option>
				<option value="3">After 10 minutes</option>
				<option value="4">After 15 minutes</option>
				<option value="5">After 20 minutes</option>
				<option value="6">After 25 minutes</option>
				<option value="7">After 30 minutes</option>
				<option value="8">After  1 hour</option>
				<option value="9">After 90 minutes</option>
				<option value="10">After  2 hours</option>
				<option value="11">After  3 hours</option>
			</select>
		</td>
	</tr>
	
	<tr>
		<th>Latitude</th>
		<td>
			<input type="number" name="latitude1" id="latitude1" value="{{conf.latitude1}}" required />&deg;
		</td>
		</tr>
        <tr>
		<th>Longitude</th>
		<td>
			<input type="number" name="longitude1" id="longitude1" value="{{conf.longitude1}}" required />&deg;
		</td>
        </tr>
        <tr>
		<th>Antenna Height (AGL)</th>
		<td>
			<input type="number" name="agl1" id="agl1" value="{{conf.agl1}}" required />&nbsp;Meters
		</td>
        </tr>
        <tr>
		<th>Description (QTH)</th>
		<td>
			<input type="text" maxlen=20 name="description1_1" id="description1_1" value="{{conf.description1_1}}" /><br/>
			<input type="text" maxlen=20 name="description1_2" id="description1_2" value="{{conf.description1_2}}" />
		</td>
        </tr>
        <tr>
       		<th>URL</th>
		<td>
			<input type="url1" name="url1" id="url1" value="{{conf.url1}}" />
		</td>
        </tr>
		
   </table>
   </fieldset>

   <fieldset>
   <legend>ircDDB Connection</legend>
   <h3>ircDDB Reporting One</h3>
   <table>
	<tr>
		<th>ircDDB Enabled</th>
		<td>
			<input type="radio" name="ircddbEnabled" id="ircddbEnabled" value="1">Yes &nbsp;
                        <input type="radio" name="ircddbEnabled" id="ircddbEnabled" value="0">No
		</td>
	</tr>
	<tr>
		<th>ircDDB Hostname</th>
		<td>
			<input type="text" name="ircddbHostname" id="irdddbHostname" value="{{conf.ircddbHostname}}" />
		</td>
	</tr>
	<tr>
		<th>ircDDB Username (callsign)</th>
		<td>
			<input type="text" name="ircddbUsername" id="ircddbUsername" value="{{conf.ircddbUsername}}" />
		</td>
	</tr>
	<tr>
		<th>ircDDB Password</th>
		<td>
			<input type="text" name="ircddbPassword" id="ircddbPassword" value="{{conf.ircddbPassword}}" />
		</td>
	</tr>
   </table>
   <h3>ircDDB Reporting Two</h3>
   <table>
	<tr>
		<th>ircDDB Enabled</th>
		<td>
			<input type="radio" name="ircddbEnabled2" id="ircddbEnabled2" value="1">Yes &nbsp;
                        <input type="radio" name="ircddbEnabled2" id="ircddbEnabled2" value="0">No
		</td>
	</tr>
	<tr>
		<th>ircDDB Hostname</th>
		<td>
			<input type="text" name="ircddbHostname2" id="irdddbHostname2" value="{{conf.ircddbHostname2}}" />
		</td>
	</tr>
	<tr>
		<th>ircDDB Username (callsign)</th>
		<td>
			<input type="text" name="ircddbUsername2" id="ircddbUsername2" value="{{conf.ircddbUsername2}}" />
		</td>
	</tr>
	<tr>
		<th>ircDDB Password</th>
		<td>
			<input type="text" name="ircddbPassword2" id="ircddbPassword2" value="{{conf.ircddbPassword2}}" />
		</td>
	</tr>
   </table>
   </fieldset>

   <fieldset>
   <legend>Gateway Location</legend>
   <table>
   </table>
   </fieldset>

   <input type="submit"/>
   <input type="reset" value="Reset" onclick="updateoptions(this)"/>
</form>
<script>

var radiobuttons = ["atStartup1","ircddbEnabled","ircddbEnabled2"];
var selects = ["gatewayType","repeaterBand1","reconnect1"];

function updateURL(callsign) {
	var urlstring = "http://" + callsign.toLowerCase().trim() + ".dgw.ar-dns.net";
	console.log(urlstring);
	$("#ircddbUsername").val(callsign.toLowerCase());
	$("#ircddbUsername2").val(callsign.toLowerCase());
	$("#url").val(urlstring);
	$("#url1").val(urlstring);
}

function updateoptions(mod) {
        var url = "/ircconfig?modFile=" + mod.value;
	console.log(url);
        $.get(url,function(data) {
                updateInputs(data,radiobuttons,selects);
        });
}

function setgateway(ele) {
        document.getElementById('gateway').value = ele.value.substring(0,7) + "G";
}

function setReflector(reflector) {
	var maxfield = "       ";
	var callsign = $('#refin').val();
	var module = $('#refmod').val();
	var selection = callsign + maxfield.substr(callsign.length) + module;
	console.log("[" + selection + "] " + selection.length);
	$(reflector).val(selection);	
}

$(function() {
        updateInputs(JSON.parse('{{{json conf}}}'),radiobuttons,selects);
	var ref1 = "{{conf.reflector1}}";
	$( "#refin" ).val(ref1.substring(0,7));
	$( "#refmod" ).val(ref1.substring(7));
	$( "#refin" ).autocomplete({
		source: "/reflector-list",
      		select: function( event, ui ) {
			console.log(ui);
	
		}
	});
});

</script>
